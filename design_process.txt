一，开发测试的流程
20200325
1.开始TaskTransitiveInference design;
1.1
把A(1-10的图片放入)，把B(11-20de图片放入)；


日志文件：
endOfTrial(successfulTrial, rew_scalar, callback);
successfulTrial点击是否正确；
// Scalar if you want to increase the reward on a particular trial (by multiplication)
    private static int rew_scalar = 1;
// Identifier for which monkey is currently playing the task
    private static int current_monkey, monkey_o =0, monkey_v =1;
开启面部识别之后，可以知道是哪只猴子，默认current_monkey=0；

这里可以使图片的位置随意动；
// Randomise cue locations
        UtilsTask.randomlyPositionCues(cues,  new UtilsTask().getPossibleCueLocs(getActivity()));

把图片固定在中心对称位置；修改上面这个函数；
这个图像的大小默认为300；("cue_size",300)
cue_size = sharedPrefs.getInt(r.getString(R.string.preftag_cue_size), r.getInteger(R.integer.default_cuesize));

给出所用可能的返回位置，用像素表示；
// Find possible locs along each dimension
        int[] xlocs = calculateLocs(screenWidth, totalImageSize);
        int[] ylocs = calculateLocs(screenHeight, totalImageSize);

参照TaskSpatialResponse.java的方法；移动位置方法；


可以参考其他任何，实现图像的切换；

20200326
task加入列表，activity_main_menu.xml；
<Spinner
    android:id="@+id/spinnerTaskMenu"
MainMenu.java line117
  Spinner spinner = (Spinner) findViewById(R.id.spinnerTaskMenu);
这里用到这个id;

line86执行intent;



后面就是选择，然后点击方框，出来TaskExample.java;
return inflater.inlfater(R.layout.activity_task_example, container, false);
开始loop.java就出来那两个选择的按钮；

同时修改，strings.xml文件，line16
<string-array name="available_tasks">
        <item>Training 1: Full screen cue</item>
        <item>Training 2: Shrinking central cue</item>
        <item>Training 3: Shrinking moving cue</item>
        <item>Training 4: Small Moving cue</item>
        <item>Training 5: Two step</item>
        <item>Example task</item>
.........................................................
        <item>Sequential Learning</item>
        <item>Random dot motion</item>

/*
MainMenu.java的第288行；
taskSelected < 5，为何没有等于5的情况，就是task_example
*/

/*
TaskTransitiveInference.java中的line68
// Randomise cue locations
        UtilsTask.randomlyPositionCues(cues,  new UtilsTask().getPossibleCueLocs(getActivity()));
//以下这些注释掉就可以了，证明，前期写的相关的都是对的；
*/

20200330
可以实现固定按钮位置，cues[0].setX(150);//Monkey O Cue1
        cues[1].setX(500);//Monkey O Cue2
        cues[0].setY(500);//Monkey O Cue1
        cues[1].setY(500);//Monkey O Cue2
如何把图片插入到按钮上；
可以参考，D:\02ability\LearnJava\Mymou\Mymou-master20191011TwoFruitsMoveBananaRewardModifyLogOnlyBanana\Behavioural Testing Unit (Android)
以及其对日志文件的修改；

把按钮的参数由
<Button
            android:text="Monkey V\n Cue 1"
            android:layout_width="175dp"
            android:layout_height="175dp"
            android:textSize="30sp"
            android:id="@+id/buttonCue1MonkV"/>
修改为
 <Button
            android:text="  "
            android:layout_width="wrap_content"
            android:layout_height="wrap_content"
            android:textSize="30sp"
            android:id="@+id/buttonCue2MonkO"
            android:layout_gravity="center|bottom"
            android:gravity="center"
            android:background="@drawable/aa"/>

把70个图片都放在同一个位置，然后，选择性的显示；
设置按钮的属性；在layout中的.xml文件也可以设置属性，drawable文件一般存的是图片；
如何在activity里设置按钮的图片？
 private void assignObjects() {
        // Monkey 0 cues
        cues_all[monkey_o][0] = getView().findViewById(R.id.buttonCue1MonkO);
        cues_all[monkey_o][1] = getView().findViewById(R.id.buttonCue2MonkO);

一句话，就搞定，在activity中设置，button的背景图片；
cues_all[monkey_o][0].setBackgroundResource(R.drawable.aaaaa);
3.
下载可以加载图片了，然后考虑，如何把70个图片都加载上；

但是若是更改文件.xml中的id号，@+id/buttonCue1MonkO；
因为由两个文件都有这个号码，后续会不会出错；
改了之后，例如ti_buttonCue1MonkO就无法出现
后来的奖励选项，一定是这个跟奖励选项相关的，的buttonCue1MonkO没有修改，可以更进出看下；
3.1
android drawable下无法添加子目录，而且图片文件名必须是以字母开头，所以需要写个python脚本
把刺激集的名称前全部加一个a;
3.2
android开发如何再代码中间加上调试信息，输出需要的变量值；
3.3
设置断点，发现每次出现的时间；按钮出现的时间，

每次调用assignObjects()时就有一个新的界面？算作一次新的trail;

4.
main主界面多了一个Task Settings
是因为，PreferencesManager.java中多了一个public void SpatialResponse(){}函数；
然后在TaskManager.java中private void loadtask(){}中加入了一个case
在使用的activity中加入prefManager = new PreferencesManager(getContext());
        prefManager.SpatialResponse();
这样还是无法显示task settings;
所以有其他联系，想到activity_main_menu.xml文件中的区别；
在xml文件夹里看到，一个preferences_task_spatialresponse.xml文件；
而且这里，其他所有带task setting的任务，都在这里有个相应的.xml文件；并且规定了task setting里所有属性的最大值；
右击 find usages,发现在哪里引用了这个文件；
PrefsFragCommon.java;在这个文件了关联了preferences_task_spatialresponse.xml还是不可以；？？？
比如说这里有一句和这个功能相关的；<string name="preftag_task_sr_settings">preftag_task_sr_settings</string>
右击find usages可以查看所有的与这个相关的同步修改；

发现列表中5和15是没有的tasksetting，一定taskid有一个没有设置正确
在MainMenu.java中第五个也就task_example是false，而新增加的还没有；
<string-array name="task_has_settings">
        <item>true</item>
        <item>true</item>
        <item>true</item>
        <item>true</item>
        <item>true</item>
        <item>false</item>
        <item>true</item>
        <item>true</item>
        <item>true</item>
        <item>true</item>
        <item>true</item>
        <item>true</item>
        <item>true</item>
        <item>true</item>
    </string-array>
添加一个true之后，task settings可以出现，但是，不是它自己的而是复制的另一个的为啥？
一直会链接到preferences_task_spatialresponse.xml不知道为啥？
调试了半天，就发现这个问题；
<string name="preftag_task_ti_settings">preftag_task_sl_settings</string>
这里的sl没有改为ti，所以默认一直往preferences_task_spatialresponse.xml跳转；
发现目标函数，用find usages可以判定在哪些地方被使用，或者用断点找到要被使用的；

在taskManager.java中，不必使用case13，为何少一个TaskRandomDotMotion();因为这里只有需要使用
因为没有使用preferencesManager.TaskRandomDotMotion();

*******可以仿照，TaskDiscreteMazeMapParams.java里的，public void LoadImageList(){}把所有照片做一个列表**********
android studio图片的命名规则：只能以小写字母和下划线做首字母，随后的名字中只能出现 [a-z0-9_.] 

从List中随机取出一个元素
1  List<Integer> list = new ArrayList<>();
2         Random random = new Random();
3         int n = random.nextInt(list.size());
4         list.get(n);

/*
 现在主程序，接近完成：
剩下日志文件，把平板上软件，删除，然后，日志文件夹删除，重新载入软件，之前的日志文件又恢复了？？？
这段log到底在哪里，为何把文件删除，android studio和平板都重启，还是会出现今天之前的log的文件；
不要用三星平板自带的阅读器，然后，打开方式里选择其他阅读器，就是正确的结果；

日志文件的格式:
每一个完整的trail，log会出现四行;
1.1先是，灰色按钮，一个log文件，就是开始的信息；(第一个是时间因该是，点击start之后的时间）
1.2任务开始的log，出现两个图片的时间（第一个时间与上一行第一个时间相同）；
1.3选择哪一个按钮的时间（第一个时间与上一行第一个时间相同）；
1.4选择奖励的时间（第一个时间与上一行第一个时间相同）；

这个日志文件，只有点击了奖励才会提交，没有点击奖励，界面会一直等待，选择的信息（i.e.，log的前三步骤不会出现）
如果需要正确率的话，是哪一个正确率，是所有trail的正确率，还是单个A-B，B-C等等的正确率；

TaskManager.java中有一个private static void endOfTrial(String outcome, int newTrialDelay)
然后又有一个提交数据的过程；commitTrialData(outcome);

鉴于public class TaskTransitiveInference extends Task implements View.OnClickListener
extends Task，
但应该是，
 public void setFragInterfaceListener(TaskInterface callback) {
        this.callback = callback;
    }的原因；
既然，出现了奖励系统的页面，才会继续进行，就看看奖励系统的变化；

*/

/*
20200603出现错误，每次都会重新进入，A->B的循环；
因为没有设置合适的全局变量，每次都会重新读取，最开始设定的值；
private static String start_sequence= "A";//加一个static，对于不同的对象，都是同一个值。
private static boolean start_sequence_read = false;//add设置在循环中只读取一次。
*/


二，Log
1. 目测可以准确记录实验数据了，这是目前的格式，你可以把需求的格式发给我，我尝试修改；

任务的流程：是先出现一个矩形框，点击之后，出现一个两个动物画面，选择之后，出现奖励界面；

2. 现在日志文件每一行代码对应如下：
2.1 每一个trai的日志有四行；
第一行：14,0,-1,1,102416_102,102416_115,,5

第一行对应：任务编号，trial编号，动物编号，任务开始的时间，点击方框消失的时间，，任务开始标记；
第二行：14,0,-1,1,102416_102,102416_160,TaskTransitiveInference started
第二行对应：任务编号，trial编号，动物编号，任务开始的时间，出现动物画面的时间；
第三行：14,0,-1,1,102416_102,102417_340,PictureNumber:6, (16,6)
第三行对应：任务编号，trial编号，动物编号，任务开始的时间，选择图片的时间，选择的图片号，图片号与位置；
第四行：14,0,-1,1,102416_102,102418_710,,1

第四行对应：任务编号，trial编号，动物编号，任务开始的时间，点击奖励的时间，，任务结束标记；

3. 以下是点击了三次的例子；
taskId, trialCounter, faceRecogPrediction, overallTrialOutcome, photoTimestamp, eventTimestamp, task manager code, task specific event codes


14,0,-1,1,102416_102,102416_115,,5

14,0,-1,1,102416_102,102416_160,TaskTransitiveInference started

14,0,-1,1,102416_102,102417_340,PictureNumber:6, (16,6)

14,0,-1,1,102416_102,102418_710,,1


14,1,-1,1,102420_919,102420_930,,5

14,1,-1,1,102420_919,102420_971,TaskTransitiveInference started

14,1,-1,1,102420_919,102422_200,PictureNumber:4, (14,4)

14,1,-1,1,102420_919,102423_171,,1


14,2,-1,1,102425_287,102425_294,,5

14,2,-1,1,102425_287,102425_333,TaskTransitiveInference started

14,2,-1,1,102425_287,102426_376,PictureNumber:2, (2,12)

14,2,-1,1,102425_287,102427_925,,1